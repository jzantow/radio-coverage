<!DOCTYPE html>
<html>
<head>
  <title>Radio Coverage Map</title>
  <meta charset="utf-8" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #controls {
      position: absolute;
      top: 60px;
      left: 10px;
      z-index: 5;
      display: flex;
      flex-direction: column;
      gap: 5px;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px;
      border-radius: 5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    input[type="text"] {
      padding: 6px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 250px;
    }

    .control-btn {
      padding: 6px 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    #legend {
      background: white;
      padding: 10px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      position: absolute;
      bottom: 10px;
      right: 10px;
      z-index: 5;
      border-radius: 5px;
    }

    .legend-color {
      display: inline-block;
      width: 15px;
      height: 15px;
      margin-right: 6px;
      vertical-align: middle;
      border-radius: 3px;
    }

    .legend-color.station {
      background: #1E90FF;
    }

    .legend-color.store {
      background: #FF6347;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlgV94Xs1mTP01IZo3wqQWpx9png3l4DE&libraries=geometry"></script>
</head>
<body>
  <div id="controls">
    <input id="storeSearchBox" type="text" placeholder="Search for store (e.g. 67, #67, name)" />
    <button id="storeSearchBtn" class="control-btn">Search Store</button>
    <input id="stationSearchBox" type="text" placeholder="Search for station (e.g. KVHT)" />
    <button id="stationSearchBtn" class="control-btn">Search Station</button>
    <button id="resetBtn" class="control-btn">Reset</button>
  </div>

  <div id="map"></div>

  <div id="legend">
    <h3>Legend</h3>
    <p><span class="legend-color station"></span> Station</p>
    <p><span class="legend-color store"></span> Store</p>
  </div>
<script>
  let map;
  let storeMarkers = [];
  let stationMarkers = [];
  let stationCircles = [];
  let infoWindows = [];
  let highlightedMarker = null;
  let hoverInfoWindow = new google.maps.InfoWindow();
  let persistentInfoWindow = new google.maps.InfoWindow();
  let persistentOpenOn = null;

  const locations = [
  {
    "Name": "KALF 95.7FM",
    "Latitude": 39.9171,
    "Longitude": -122.6706,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> New Country<br><b>Station Rank:</b>  9t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KBQB 92.7FM",
    "Latitude": 39.7281,
    "Longitude": -121.8372,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Adult Hits<br><b>Station Rank:</b>  6t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KCEZ 102.1FM",
    "Latitude": 40.0242,
    "Longitude": -122.1,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Pop Contemporary Hit<br><b>Station Rank:</b>  4t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KRQR 106.7FM",
    "Latitude": 39.7472,
    "Longitude": -122.19,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Active Rock<br><b>Station Rank:</b>  1t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KTHU 100.7FM",
    "Latitude": 39.9275,
    "Longitude": -122.1797,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Classic Rock<br><b>Station Rank:</b>  4t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KDUK 104.7FM",
    "Latitude": 44.0521,
    "Longitude": -123.0868,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Pop CHR<br><b>Station Rank:</b>  #4t<br><b>Live:</b> MAR17-APR04<br>"
  },
  {
    "Name": "KEHK 102.3FM",
    "Latitude": 44.0521,
    "Longitude": -123.0868,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Hot AC<br><b>Station Rank:</b>  #9t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KEUG 105.5FM",
    "Latitude": 44.0521,
    "Longitude": -123.0868,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Adult Hits<br><b>Station Rank:</b>  #3<br><b>Live:</b> MAR17-APR04<br>"
  },
  {
    "Name": "KKNU 93.3FM",
    "Latitude": 44.0521,
    "Longitude": -123.0868,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Country<br><b>Station Rank:</b>  #1<br><b>Live:</b> MAR17-APR04<br>"
  },
  {
    "Name": "KMGE 94.5FM",
    "Latitude": 44.0521,
    "Longitude": -123.0868,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> AC<br><b>Station Rank:</b>  #4t<br><b>Live:</b> MAR17-APR04<br>"
  },
  {
    "Name": "KNRQ 103.7FM",
    "Latitude": 44.0521,
    "Longitude": -123.0868,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Alt<br><b>Station Rank:</b>  #8<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KZEL 96.1FM",
    "Latitude": 44.0521,
    "Longitude": -123.0868,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Cl Rock<br><b>Station Rank:</b>  #2<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KBFF 95.5FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Pop CHR<br><b>Station Rank:</b>  #10t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KFBW 105.9FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Cl Rock<br><b>Station Rank:</b>  #8<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KGON 92.3FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Cl Rock<br><b>Station Rank:</b>  #7<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KINK 101.9FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Album Ad Alternative<br><b>Station Rank:</b>  #3<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KKCW 103.3FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> AC<br><b>Station Rank:</b>  #1t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KKRZ 100.3FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Pop CHR<br><b>Station Rank:</b>  #9<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KLTH 106.7FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Cl Hits<br><b>Station Rank:</b>  #1t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KNRK 94.7FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Alternative<br><b>Station Rank:</b>  #13t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KUPL 98.7FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Country<br><b>Station Rank:</b>  #16<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KWJJ 99.5FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Country<br><b>Station Rank:</b>  #12<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KXJM 107.5FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Rhythmic CHR<br><b>Station Rank:</b>  #13t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KXL  101.1FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> News Talk<br><b>Station Rank:</b>  #6<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KYCH 97.1FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> AC<br><b>Station Rank:</b>  #4<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KESR 107.1FM",
    "Latitude": 40.5865,
    "Longitude": -122.3917,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Adult Hits<br><b>Station Rank:</b>  #3t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KEWB 94.7FM",
    "Latitude": 40.5865,
    "Longitude": -122.3917,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Pop Contemporary Hit<br><b>Station Rank:</b>  #5t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KHRD 103.1FM",
    "Latitude": 40.5865,
    "Longitude": -122.3917,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Classic Rock<br><b>Station Rank:</b>  #3t<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KNCQ 97.3FM",
    "Latitude": 40.5865,
    "Longitude": -122.3917,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Country<br><b>Station Rank:</b>  #1<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KRRX 106.1FM",
    "Latitude": 40.5865,
    "Longitude": -122.3917,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Active Rock<br><b>Station Rank:</b>  #2<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KRYP 93.1FM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Mex Regional<br><b>Station Rank:</b>  #1<br><b>Live:</b> MAR17-APR04<br>"
  },
  {
    "Name": "KGAL 1580AM",
    "Latitude": 44.6365,
    "Longitude": -123.1059,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> News Talk<br><b>Station Rank:</b> <br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KHPE 107.9FM",
    "Latitude": 44.6365,
    "Longitude": -123.1059,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Cont. Christian<br><b>Station Rank:</b> <br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KLOO 106.3FM",
    "Latitude": 44.6365,
    "Longitude": -123.1059,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Cl Rock<br><b>Station Rank:</b>  #2 Linn County #1 Benton County<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KRKT 99.9FM",
    "Latitude": 44.6365,
    "Longitude": -123.1059,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Country<br><b>Station Rank:</b>  #1 Linn County #2 Benton County<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KLRR 101.7FM",
    "Latitude": 44.0582,
    "Longitude": -121.3153,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Adult Alt.<br><b>Station Rank:</b>  #6t Deschutes County<br><b>Live:</b> MAR03-MAR21<br>"
  },
  {
    "Name": "KMTK 99.7FM",
    "Latitude": 44.0582,
    "Longitude": -121.3153,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Country<br><b>Station Rank:</b>  #5t Deschutes County<br><b>Live:</b> MAR03-MAR21<br>"
  },
  {
    "Name": "KRXF 92.9FM",
    "Latitude": 44.0582,
    "Longitude": -121.3153,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Modern Rock<br><b>Station Rank:</b>  #2 Deschutes County<br><b>Live:</b> MAR03-DEC05<br>"
  },
  {
    "Name": "KDCQ 92.9FM",
    "Latitude": 43.3665,
    "Longitude": -124.2179,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Cl Hits<br><b>Station Rank:</b>  #1 Coos County<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KMHS  105.1FM 1420AM",
    "Latitude": 43.3665,
    "Longitude": -124.2179,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Country HS Sports<br><b>Station Rank:</b> <br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KYTT 98.7FM",
    "Latitude": 43.3665,
    "Longitude": -124.2179,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Cont. Christian<br><b>Station Rank:</b>  #6 Coos County<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KAJO 1270AM",
    "Latitude": 42.439,
    "Longitude": -123.327,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> AC<br><b>Station Rank:</b>  #1 Josephine County<br><b>Live:</b> MAR17-APR04<br>"
  },
  {
    "Name": "KLDR 98.3FM",
    "Latitude": 42.439,
    "Longitude": -123.327,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Hot AC<br><b>Station Rank:</b>  #4 Josephine County<br><b>Live:</b> MAR17-APR04<br>"
  },
  {
    "Name": "KROG 96.9FM",
    "Latitude": 42.439,
    "Longitude": -123.327,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Rock<br><b>Station Rank:</b>  #2 Josephine County<br><b>Live:</b> MAR17-APR04<br>"
  },
  {
    "Name": "KBOY 95.7FM",
    "Latitude": 42.439,
    "Longitude": -123.327,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Cl Rock<br><b>Station Rank:</b>  #3 Jackson County<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KCMX 101.9FM",
    "Latitude": 42.439,
    "Longitude": -123.327,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Soft AC<br><b>Station Rank:</b>  #1 Jackson County<br><b>Live:</b> MAR17-DEC05<br>"
  },
  {
    "Name": "KRWQ 100.3FM",
    "Latitude": 42.439,
    "Longitude": -123.327,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> Country<br><b>Station Rank:</b>  #4 Jackson County<br><b>Live:</b> MAR17-APR04<br>"
  },
  {
    "Name": "KFXX 1080AM",
    "Latitude": 45.5231,
    "Longitude": -122.6765,
    "Radius": 60,
    "Type": "Station",
    "Info": "<b>Genre:</b> All Sports<br><b>Station Rank:</b>  #21t DJ End for Jason Swygard<br><b>Live:</b> MAR17-DEC07<br>"
  }
  {
    "Name": "Austin #467",
    "Latitude": 43.685315,
    "Longitude": -92.98044283,
    "Radius": 5,
    "Type": "Store",
  }
  {
    "Name": "Bend South Tire Center",
    "Latitude": 44.01846,
    "Longitude": -121.318034,
    "Radius": 0,
    "Type": "Store"
  },
  {
    "Name": "Bend Cooley Road",
    "Latitude": 44.108728,
    "Longitude": -121.30116,
    "Radius": 0,
    "Type": "Store"
  }
  ];

  const colors = {
    "Station": "#1E90FF",
    "Store": "#FF6347"
  };

  function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
      zoom: 5,
      center: { lat: 39.5, lng: -98.35 },
      gestureHandling: "greedy",
      disableDefaultUI: false
    });

    locations.forEach((loc) => {
      const position = { lat: loc.Latitude, lng: loc.Longitude };
      const color = colors[loc.Type] || "#000";

      const circle = new google.maps.Circle({
        strokeColor: color,
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: color,
        fillOpacity: 0.25,
        map: loc.Type === "Station" ? map : null,
        center: position,
        radius: loc.Radius * 1609.34
      });

      const marker = new google.maps.Marker({
        position,
        map,
        title: loc.Name,
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 7,
          fillColor: color,
          fillOpacity: 1,
          strokeWeight: 1,
          strokeColor: "#fff"
        }
      });

      if (loc.Type === "Store") {
        storeMarkers.push(marker);

        marker.addListener("mouseover", () => {
          if (persistentOpenOn === marker) return;
          hoverInfoWindow.setContent(generateStoreInfo(loc));
          hoverInfoWindow.open(map, marker);
        });

        marker.addListener("mouseout", () => {
          if (persistentOpenOn !== marker) {
            hoverInfoWindow.close();
          }
        });

        marker.addListener("click", () => {
          persistentInfoWindow.setContent(generateStoreInfo(loc));
          persistentInfoWindow.open(map, marker);
          persistentOpenOn = marker;
        });

      } else if (loc.Type === "Station") {
        stationMarkers.push(marker);
        stationCircles.push(circle);

        circle.addListener("mouseover", (e) => {
          const info = `<strong>${loc.Name}</strong><br>${loc.Info}`;
          hoverInfoWindow.setContent(info);
          hoverInfoWindow.setPosition(e.latLng);
          hoverInfoWindow.open(map);
        });

        circle.addListener("mouseout", () => {
          hoverInfoWindow.close();
        });
      }
    });

    // Store search
    document.getElementById("storeSearchBtn").addEventListener("click", () => {
      const value = document.getElementById("storeSearchBox").value.trim().toLowerCase();
      if (!value) return;

      const match = storeMarkers.find(marker => {
        const title = marker.getTitle().toLowerCase();
        const matchNum = title.match(/#?(\d+)/);
        return (
          title.includes(value) ||
          (matchNum && matchNum[1] === value.replace("#", ""))
        );
      });

      if (match) {
        map.setCenter(match.getPosition());
        map.setZoom(8);

        if (highlightedMarker) {
          resetMarkerIcon(highlightedMarker);
          highlightedMarker = null;
        }

        highlightedMarker = match;
        match.setIcon({
          path: google.maps.SymbolPath.CIRCLE,
          scale: 10,
          fillColor: "#FFD700",
          fillOpacity: 1,
          strokeWeight: 2,
          strokeColor: "#B8860B"
        });
      } else {
        alert("No matching store found.");
      }
    });

    // Station search
    document.getElementById("stationSearchBtn").addEventListener("click", () => {
      const value = document.getElementById("stationSearchBox").value.trim().toLowerCase();
      if (!value) return;

      const match = stationMarkers.find(marker =>
        marker.getTitle().toLowerCase().includes(value)
      );

      if (match) {
        map.setCenter(match.getPosition());
        map.setZoom(8);
      } else {
        alert("No matching station found.");
      }
    });

    // Reset button
    document.getElementById("resetBtn").addEventListener("click", () => {
      document.getElementById("storeSearchBox").value = "";
      document.getElementById("stationSearchBox").value = "";
      map.setZoom(5);
      map.setCenter({ lat: 39.5, lng: -98.35 });

      if (highlightedMarker) {
        resetMarkerIcon(highlightedMarker);
        highlightedMarker = null;
      }

      persistentInfoWindow.close();
      persistentOpenOn = null;
    });
  }

  function resetMarkerIcon(marker) {
    marker.setIcon({
      path: google.maps.SymbolPath.CIRCLE,
      scale: 7,
      fillColor: "#FF6347",
      fillOpacity: 1,
      strokeWeight: 1,
      strokeColor: "#fff"
    });
  }

function generateStoreInfo(loc) {
  const stationsInRange = stationCircles
    .map(circle => {
      const distance = google.maps.geometry.spherical.computeDistanceBetween(
        new google.maps.LatLng(loc.Latitude, loc.Longitude),
        circle.getCenter()
      );
      if (distance <= circle.getRadius()) {
        const station = locations.find(l =>
          l.Type === "Station" &&
          l.Latitude === circle.getCenter().lat() &&
          l.Longitude === circle.getCenter().lng()
        );
        return station?.Name;
      }
      return null;
    })
    .filter(Boolean);

  // Deduplicate station names
  const uniqueStations = [...new Set(stationsInRange)];

  return `
    <strong>${loc.Name}</strong><br>
    ${loc.Info}<br>
    <b>In Range Of:</b><br>${uniqueStations.length ? uniqueStations.join(", ") : "None"}
  `;
}

  window.onload = initMap;
</script>
</body>
</html>
