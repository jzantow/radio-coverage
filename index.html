<!DOCTYPE html>
<html>
<head>
  <title>Radio Coverage Map</title>
  <meta charset="utf-8">
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #searchBox {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 5;
      width: 250px;
      padding: 8px;
      font-size: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #legend {
      background: white;
      padding: 10px;
      margin: 10px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .legend-color {
      display: inline-block;
      width: 15px;
      height: 15px;
      margin-right: 6px;
      vertical-align: middle;
      border-radius: 3px;
    }

    .legend-color.station {
      background: #1E90FF;
    }

    .legend-color.store {
      background: #FF6347;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlgV94Xs1mTP01IZo3wqQWpx9png3l4DE&libraries=geometry"></script>
</head>
<body>
  <input id="searchBox" type="text" placeholder="Search for store..." />
  <div id="map"></div>
  <div id="legend">
    <h3>Legend</h3>
    <p><span class="legend-color station"></span> Station</p>
    <p><span class="legend-color store"></span> Store</p>
  </div>

  <script>
    function initMap() {
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 8,
        center: { lat: 43.65, lng: -93.1 }
      });

      const colors = {
        "Station": "#1E90FF", // Dodger Blue
        "Store": "#FF6347"    // Tomato Red
      };

      const locations = [
        {
          Name: "KAUS-FM",
          Latitude: 43.628293,
          Longitude: -93.153534,
          Radius: 100,
          Type: "Station"
        },
        {
          Name: "Austin #467",
          Latitude: 43.685315,
          Longitude: -92.98044283,
          Radius: 5,
          Type: "Store"
        }
      ];

      const storeMarkers = [];
      const stationMarkers = [];
      const stationCircles = [];

      locations.forEach((loc, index) => {
        const center = { lat: loc.Latitude, lng: loc.Longitude };
        const color = colors[loc.Type] || "#000000";

        const circle = new google.maps.Circle({
          strokeColor: color,
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: color,
          fillOpacity: 0.25,
          map: loc.Type === "Station" ? map : null,
          center: center,
          radius: loc.Radius * 1609.34
        });

        const marker = new google.maps.Marker({
          position: center,
          map,
          title: loc.Name,
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 7,
            fillColor: color,
            fillOpacity: 1,
            strokeWeight: 1,
            strokeColor: "#fff"
          }
        });

        const infoWindow = new google.maps.InfoWindow({
          content: loc.Name
        });

        marker.addListener("mouseover", () => {
          infoWindow.open(map, marker);
        });

        marker.addListener("mouseout", () => {
          infoWindow.close();
        });

        if (loc.Type === "Store") {
          storeMarkers.push(marker);
        } else {
          stationMarkers.push(marker);
          stationCircles.push(circle);
        }
      });

      // Add legend to map
      const legend = document.getElementById("legend");
      map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);

      // Search functionality
      document.getElementById("searchBox").addEventListener("input", function () {
        const searchTerm = this.value.toLowerCase();

        // Hide everything first
        storeMarkers.forEach(m => m.setVisible(false));
        stationMarkers.forEach(m => m.setVisible(false));
        stationCircles.forEach(c => c.setMap(null));

        // Find store
        const store = locations.find(l =>
          l.Type === "Store" && l.Name.toLowerCase().includes(searchTerm)
        );

        if (!store) return;

        const storeLatLng = new google.maps.LatLng(store.Latitude, store.Longitude);

        map.setCenter(storeLatLng);
        map.setZoom(10);

        // Show store marker
        const storeMarker = storeMarkers.find(m => m.getTitle() === store.Name);
        if (storeMarker) storeMarker.setVisible(true);

        // Show covering stations
        locations.forEach((loc, idx) => {
          if (loc.Type === "Station") {
            const stationLatLng = new google.maps.LatLng(loc.Latitude, loc.Longitude);
            const radiusMeters = loc.Radius * 1609.34;
            const distance = google.maps.geometry.spherical.computeDistanceBetween(storeLatLng, stationLatLng);

            if (distance <= radiusMeters) {
              const marker = stationMarkers[idx];
              const circle = stationCircles[idx];
              marker.setVisible(true);
              circle.setMap(map);
            }
          }
        });
      });
    }

    window.onload = initMap;
  </script>
</body>
</html>
