<!DOCTYPE html>
<html>
<head>
  <title>Radio Coverage Map</title>
  <meta charset="utf-8" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #controls {
      position: absolute;
      top: 60px;
      left: 10px;
      z-index: 5;
      display: flex;
      flex-direction: row;
      gap: 5px;
      align-items: center;
      background: rgba(255, 255, 255, 0.9);
      padding: 6px;
      border-radius: 5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    #searchBox {
      width: 250px;
      padding: 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: white;
    }

    .control-btn {
      padding: 8px 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    #legend {
      background: white;
      padding: 10px;
      margin: 10px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      position: absolute;
      bottom: 10px;
      right: 10px;
      z-index: 5;
      border-radius: 5px;
    }

    .legend-color {
      display: inline-block;
      width: 15px;
      height: 15px;
      margin-right: 6px;
      vertical-align: middle;
      border-radius: 3px;
    }

    .legend-color.station {
      background: #1E90FF;
    }

    .legend-color.store {
      background: #FF6347;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlgV94Xs1mTP01IZo3wqQWpx9png3l4DE&libraries=geometry"></script>
</head>
<body>
  <div id="controls">
    <input id="searchBox" type="text" placeholder="Search for store by # (e.g. 67)" />
    <button id="searchBtn" class="control-btn">Search</button>
    <button id="resetBtn" class="control-btn">Reset</button>
  </div>

  <div id="map"></div>

  <div id="legend">
    <h3>Legend</h3>
    <p><span class="legend-color station"></span> Station</p>
    <p><span class="legend-color store"></span> Store</p>
  </div>

  <script>
    let map;
    let storeMarkers = [];
    let stationMarkers = [];
    let stationCircles = [];
    let infoWindows = [];
    let highlightedMarker = null;

    const locations = [
      {
        Name: "KAUS-FM",
        Latitude: 43.628293,
        Longitude: -93.153534,
        Radius: 100,
        Type: "Station",
        Info: "<b>Genre:</b> Country<br><b>Station Rank:</b> #1"
      },
      {
        Name: "Austin #467",
        Latitude: 43.685315,
        Longitude: -92.98044283,
        Radius: 5,
        Type: "Store",
        Info: "Region: North Central<br>Date Opened: 2024"
      },
      {
        Name: "Bakersfield Buck Owens #566",
        Latitude: 35.387762,
        Longitude: -119.042628,
        Radius: 1,
        Type: "Store",
        Info: "Region: Inland Empire<br>Date Opened: 2023"
      },
      {
        Name: "Bakersfield Calloway Dr #67",
        Latitude: 35.410107,
        Longitude: -119.110601,
        Radius: 1,
        Type: "Store",
        Info: "Region: Inland Empire<br>Date Opened: 2025"
      },
      {
        Name: "KUZZ-FM",
        Latitude: 35.438000,
        Longitude: -118.740944,
        Radius: 70,
        Type: "Station",
        Info: "<b>Genre:</b> Top 40<br><b>Station Rank:</b> #2"
      }
    ];

    const colors = {
      "Station": "#1E90FF",
      "Store": "#FF6347"
    };

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 5,
        center: { lat: 39.5, lng: -98.35 }
      });

      locations.forEach((loc) => {
        const center = { lat: loc.Latitude, lng: loc.Longitude };
        const color = colors[loc.Type] || "#000";

        const circle = new google.maps.Circle({
          strokeColor: color,
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: color,
          fillOpacity: 0.25,
          map: loc.Type === "Station" ? map : null,
          center,
          radius: loc.Radius * 1609.34
        });

        const marker = new google.maps.Marker({
          position: center,
          map,
          title: loc.Name,
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 7,
            fillColor: color,
            fillOpacity: 1,
            strokeWeight: 1,
            strokeColor: "#fff"
          }
        });

        const infoWindowContent = `<strong>${loc.Name}</strong><br>${loc.Info || ""}`;

        const infoWindow = new google.maps.InfoWindow({
          content: infoWindowContent
        });

        marker.addListener("click", () => {
          infoWindows.forEach(iw => iw.close());
          infoWindow.open(map, marker);
        });

        if (loc.Type === "Station") {
          circle.addListener("click", () => {
            infoWindows.forEach(iw => iw.close());
            infoWindow.setPosition(circle.getCenter());
            infoWindow.open(map);
          });
          stationMarkers.push(marker);
          stationCircles.push(circle);
        } else {
          storeMarkers.push(marker);
        }

        infoWindows.push(infoWindow);
      });

      const legend = document.getElementById("legend");
      map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);

      document.getElementById("searchBox").addEventListener("keydown", function(event) {
        if (event.key === "Enter") {
          handleSearch();
        }
      });

      document.getElementById("searchBtn").addEventListener("click", handleSearch);
      document.getElementById("resetBtn").addEventListener("click", resetMap);
    }

    function handleSearch() {
      const searchTerm = document.getElementById("searchBox").value.trim();
      if (!searchTerm) return;

      const match = locations.find(l => {
        if (l.Type !== "Store") return false;
        const matchNum = l.Name.match(/#(\d+)/);
        if (!matchNum) return false;
        return matchNum[1] === searchTerm;
      });

      if (match) {
        const latLng = new google.maps.LatLng(match.Latitude, match.Longitude);

        map.panTo(latLng);
        map.setZoom(8);

        if (highlightedMarker) {
          resetMarkerIcon(highlightedMarker);
          highlightedMarker = null;
        }

        const marker = storeMarkers.find(m => {
          const title = m.getTitle();
          const markerNum = title.match(/#(\d+)/);
          return markerNum && markerNum[1] === searchTerm;
        });

        if (marker) {
          highlightedMarker = marker;
          marker.setIcon({
            path: google.maps.SymbolPath.CIRCLE,
            scale: 10,
            fillColor: "#FFD700",
            fillOpacity: 1,
            strokeWeight: 2,
            strokeColor: "#B8860B"
          });
        }
      } else {
        alert("No matching store found.");
      }
    }

    function resetMarkerIcon(marker) {
      const originalColor = colors["Store"];
      marker.setIcon({
        path: google.maps.SymbolPath.CIRCLE,
        scale: 7,
        fillColor: originalColor,
        fillOpacity: 1,
        strokeWeight: 1,
        strokeColor: "#fff"
      });
    }

    function resetMap() {
      document.getElementById("searchBox").value = "";

      if (highlightedMarker) {
        resetMarkerIcon(highlightedMarker);
        highlightedMarker = null;
      }

      map.setZoom(5);
      map.setCenter({ lat: 39.5, lng: -98.35 });
    }

    window.onload = initMap;
  </script>
</body>
</html>
