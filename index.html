<!DOCTYPE html>
<html>
<head>
  <title>Radio Coverage Map</title>
  <meta charset="utf-8" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 5;
      display: flex;
      flex-direction: row;
      gap: 5px;
      align-items: center;
    }

    #searchBox {
      width: 250px;
      padding: 8px;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      border: 1px solid #ccc;
      border-radius: 4px;
      background: white;
    }

    .control-btn {
      padding: 8px 12px;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      border: 1px solid #ccc;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      user-select: none;
    }

    #legend {
      background: white;
      padding: 10px;
      margin: 10px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      position: absolute;
      bottom: 10px;
      right: 10px;
      z-index: 5;
    }

    .legend-color {
      display: inline-block;
      width: 15px;
      height: 15px;
      margin-right: 6px;
      vertical-align: middle;
      border-radius: 3px;
    }

    .legend-color.station {
      background: #1E90FF;
    }

    .legend-color.store {
      background: #FF6347;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlgV94Xs1mTP01IZo3wqQWpx9png3l4DE&libraries=geometry"></script>
</head>
<body>
  <div id="controls">
    <input id="searchBox" type="text" placeholder="Search for store..." />
    <button id="searchBtn" class="control-btn">Search</button>
    <button id="resetBtn" class="control-btn">Reset</button>
  </div>

  <div id="map"></div>

  <div id="legend">
    <h3>Legend</h3>
    <p><span class="legend-color station"></span> Station</p>
    <p><span class="legend-color store"></span> Store</p>
  </div>

  <script>
    let map;
    let storeMarkers = [];
    let stationMarkers = [];
    let stationCircles = [];
    let infoWindows = [];

    const locations = [
      { Name: "KAUS-FM", Latitude: 43.628293, Longitude: -93.153534, Radius: 100, Type: "Station" },
      { Name: "Austin #467", Latitude: 43.685315, Longitude: -92.98044283, Radius: 5, Type: "Store" },
      { Name: "Bakersfield Buck Owens", Latitude: 35.387762, Longitude: -119.042628, Radius: 1, Type: "Store" },
      { Name: "Bakersfield Calloway Dr", Latitude: 35.410107, Longitude: -119.110601, Radius: 1, Type: "Store" },
      { Name: "KUZZ-FM", Latitude: 35.438000, Longitude: -118.740944, Radius: 70, Type: "Station" }
    ];

    const colors = {
      "Station": "#1E90FF",
      "Store": "#FF6347"
    };

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 5,
        center: { lat: 39.5, lng: -98.35 }
      });

      locations.forEach((loc) => {
        const center = { lat: loc.Latitude, lng: loc.Longitude };
        const color = colors[loc.Type] || "#000";

        const circle = new google.maps.Circle({
          strokeColor: color,
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: color,
          fillOpacity: 0.25,
          map: loc.Type === "Station" ? map : null,
          center,
          radius: loc.Radius * 1609.34
        });

        const marker = new google.maps.Marker({
          position: center,
          map,
          title: loc.Name,
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 7,
            fillColor: color,
            fillOpacity: 1,
            strokeWeight: 1,
            strokeColor: "#fff"
          }
        });

        const infoWindow = new google.maps.InfoWindow({ content: loc.Name });

        marker.addListener("mouseover", () => infoWindow.open(map, marker));
        marker.addListener("mouseout", () => infoWindow.close());

        circle.addListener("mouseover", (e) => {
          infoWindow.setPosition(e.latLng);
          infoWindow.setContent(loc.Name);
          infoWindow.open(map);
        });
        circle.addListener("mouseout", () => infoWindow.close());

        infoWindows.push(infoWindow);

        if (loc.Type === "Store") storeMarkers.push(marker);
        else {
          stationMarkers.push(marker);
          stationCircles.push(circle);
        }
      });

      // Legend
      const legend = document.getElementById("legend");
      map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);

      // Search on Enter key
      document.getElementById("searchBox").addEventListener("keydown", function(event) {
        if (event.key === "Enter") {
          handleSearch();
        }
      });

      // Search button
      document.getElementById("searchBtn").addEventListener("click", handleSearch);

      // Reset button
      document.getElementById("resetBtn").addEventListener("click", resetMap);
    }

    function handleSearch() {
      const searchTerm = document.getElementById("searchBox").value.toLowerCase().trim();

      if (!searchTerm) return;  // ignore empty search

      const match = locations.find(
        l => l.Type === "Store" && l.Name.toLowerCase().includes(searchTerm)
      );

      if (match) {
        const latLng = new google.maps.LatLng(match.Latitude, match.Longitude);

        map.panTo(latLng);
        map.setZoom(6);

        // Highlight the marker
        const marker = storeMarkers.find(m => m.getTitle().toLowerCase().includes(searchTerm));
        if (marker) {
          marker.setAnimation(google.maps.Animation.BOUNCE);

          const originalIcon = marker.getIcon();
          const originalFillColor = originalIcon.fillColor;

          marker.setIcon({
            ...originalIcon,
            fillColor: "#FFD700"  // Gold highlight
          });

          setTimeout(() => {
            marker.setAnimation(null);
            marker.setIcon({
              ...originalIcon,
              fillColor: originalFillColor
            });
          }, 2000);
        }
      } else {
        alert("No matching store found.");
      }
    }

    function resetMap() {
      document.getElementById("searchBox").value = "";
      map.setZoom(5);
      map.setCenter({ lat: 39.5, lng: -98.35 });
    }

    window.onload = initMap;
  </script>
</body>
</html>
